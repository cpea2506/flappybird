'use strict';class Game{constructor(){this.offCanvas=document.getElementById("off-canvas"),this.offContext=this.offCanvas.getContext("2d"),this.width=this.offCanvas.width,this.height=this.offCanvas.height,this.div=document.getElementById("div-canvas"),this.canvas=document.createElement("canvas"),this.canvas.width=288,this.canvas.height=512,this.div.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.trackingFps={elapsed:0,now:0,then:0,fpsInterval:0},this.bg=new Bg(this),this.pipe=new Pipe(this),this.base=new Base(this),this.bird=new Bird(this),this.announce=new Announce(this),this.score=new Score(this),this.state={ready:0,play:1,over:2},this.currentState=this.state.ready,this.themeAu=new Audio("audio/theme.mp3")}init(){this.bg.init(),this.base.init(),this.bird.init(),this.pipe.init(),this.announce.init()}startAnimating(a){this.trackingFps.fpsInterval=1e3/a,this.trackingFps.then=Date.now(),this.play()}play(){const a=requestAnimationFrame(this.play.bind(this));this.trackingFps.now=Date.now(),this.trackingFps.elapsed=this.trackingFps.now-this.trackingFps.then,this.trackingFps.elapsed>this.trackingFps.fpsInterval&&(this.trackingFps.then=this.trackingFps.now-this.trackingFps.elapsed%this.trackingFps.fpsInterval,this.update(),this.draw(),this.checkLose(a))}checkLose(a){this.currentState===this.state.over&&(this.themeAu.pause(),this.bird.restartDone&&cancelAnimationFrame(a))}update(){this.currentState===this.state.play&&(this.themeAu.volume=.1,this.themeAu.play()),this.bg.update(),this.pipe.update(),this.announce.update(),this.score.update(),this.bird.update(),this.base.update()}draw(){this.bg.draw(),this.pipe.draw(),this.announce.draw(),this.score.draw(),this.bird.draw(),this.base.draw(),this.context.drawImage(this.offCanvas,0,0,this.width,this.height)}mousePos(a,b){let c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}restartClick(a){const b=this.mousePos(this.canvas,a),c=this.announce.restartBtn;return b.x>=c.x&&b.x<=c.x+c.w&&b.y>=c.y&&b.y<=c.y+c.h}flapEvent(){this.currentState!==this.state.over&&this.bird.flap()}}window.onload=()=>{const a=60;let b=new Game;b.init(),b.startAnimating(60),document.addEventListener("click",c=>{b.flapEvent(),b.bird.heavenDone&&b.restartClick(c)&&(b.div.removeChild(b.canvas),b=new Game,b.init(),b.startAnimating(a))}),document.addEventListener("keydown",c=>{" "===c.key&&(b.flapEvent(),b.bird.heavenDone&&(b.div.removeChild(b.canvas),b=new Game,b.init(),b.startAnimating(a)))})};
